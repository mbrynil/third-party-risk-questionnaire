{% extends "base.html" %}

{% block title %}Vendor Intake Requests - RiskQ{% endblock %}

{% block breadcrumbs %}
<li class="breadcrumb-item"><a href="/">Home</a></li>
<li class="breadcrumb-item active">Vendor Intake</li>
{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-start">
    <div>
        <h1>
            <i class="bi bi-box-arrow-in-right me-2"></i>Vendor Intake Requests
            {% if pending_count > 0 %}
            <span class="badge bg-warning text-dark" style="font-size:0.5em;vertical-align:middle;">{{ pending_count }} Pending</span>
            {% endif %}
        </h1>
        <p class="text-muted">Manage vendor onboarding requests from business stakeholders</p>
    </div>
    <a href="/intake/new" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i>New Request
    </a>
</div>

{% if intake_requests %}
<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Vendor Name</th>
                    <th>Department</th>
                    <th>Urgency</th>
                    <th>Status</th>
                    <th>Requested By</th>
                    <th>Created</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for req in intake_requests %}
                <tr>
                    <td class="fw-semibold">{{ req.vendor_name }}</td>
                    <td>{{ req.department or '—' }}</td>
                    <td>
                        {% if req.urgency == 'HIGH' %}
                        <span class="badge bg-danger">HIGH</span>
                        {% elif req.urgency == 'MEDIUM' %}
                        <span class="badge bg-warning text-dark">MEDIUM</span>
                        {% else %}
                        <span class="badge bg-success">LOW</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if req.status == 'PENDING' %}
                        <span class="badge bg-warning text-dark">PENDING</span>
                        {% elif req.status == 'APPROVED' %}
                        <span class="badge bg-success">APPROVED</span>
                        {% elif req.status == 'REJECTED' %}
                        <span class="badge bg-danger">REJECTED</span>
                        {% elif req.status == 'CONVERTED' %}
                        <span class="badge bg-primary">CONVERTED</span>
                        {% else %}
                        <span class="badge bg-secondary">{{ req.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ req.requested_by.display_name if req.requested_by else '—' }}</td>
                    <td>{{ req.created_at.strftime('%Y-%m-%d %H:%M') if req.created_at else '—' }}</td>
                    <td class="text-end">
                        <a href="/intake/{{ req.id }}" class="btn btn-sm btn-outline-primary">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body text-center py-5 text-muted">
        <i class="bi bi-box-arrow-in-right" style="font-size:2rem;"></i>
        <p class="mt-2">No intake requests yet. Click "New Request" to submit one.</p>
    </div>
</div>
{% endif %}
{% endblock %}
